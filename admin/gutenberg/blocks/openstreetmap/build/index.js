(()=>{"use strict";const e=window.React,{registerBlockType:t}=wp.blocks,{InspectorControls:a}=wp.blockEditor,{PanelBody:r,TextControl:s,SelectControl:n,TextareaControl:o}=wp.components,{Component:l,Fragment:i}=wp.element,{__}=wp.i18n;t("hupa/openstreetmap-iframe",{title:"OpenStreetMap Iframe",icon:()=>(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"21",fill:"currentColor",className:"bi bi-pin-map-fill",viewBox:"0 0 16 16"},(0,e.createElement)("path",{fillRule:"evenodd",d:"M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8z"}),(0,e.createElement)("path",{fillRule:"evenodd",d:"M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"})),category:"theme-v3-addons",description:"OpenStreetMap (iFrame) – mit zahlreichen Anpassungsmöglichkeiten.",attributes:{datenschutz:{type:"string",default:""},iframeUrl:{type:"string",default:"https://www.openstreetmap.org/export/embed.html"},largeUrl:{type:"string",default:""},iframeWidth:{type:"number",default:600},iframeHeight:{type:"number",default:450}},edit:class extends l{constructor(e){super(...arguments),this.props=e,this.osmIframe=React.createRef(),this.state={datenschutzSelects:[]}}componentDidMount(){this.sendFetchApi({method:"get_maps_items"})}onUrlChange=e=>{const t=(e=>{try{const t=decodeURIComponent(e.replace(/&amp;/g,"&"));return/^https:\/\/www\.openstreetmap\.org\/export\/embed\.html\?bbox=.+(&marker=\d+\.\d+,-?\d+\.\d+)?/.test(t)?t:"https://www.openstreetmap.org/export/embed.html"}catch(e){return console.error(e.message),"https://www.openstreetmap.org/export/embed.html"}})(e);this.props.setAttributes({iframeUrl:t})};onLargeUrlChange=e=>{this.props.setAttributes({largeUrl:e})};onWidthChange=e=>{this.props.setAttributes({iframeWidth:e})};onHeightChange=e=>{this.props.setAttributes({iframeHeight:e})};onChangeDatenschutz=e=>{this.props.setAttributes({datenschutz:e})};sendFetchApi(e,t=hummeltRestEditorObj.gutenberg_rest_path+"settings"){wp.apiFetch({path:t,method:"POST",data:e}).then((e=>{"get_maps_items"===e.type&&e.status&&this.setState({datenschutzSelects:e.datenschutz_selects})})).catch((e=>{"rest_permission_error"!==e.code&&"rest_failed"!==e.code||console.log(e.message)}))}render(){const{attributes:{datenschutz:t,iframeUrl:l,iframeWidth:m,iframeHeight:h,largeUrl:p}}=this.props;return(0,e.createElement)(i,null,(0,e.createElement)(a,null,(0,e.createElement)(r,{title:"Einstellungen"},(0,e.createElement)(n,{label:__("Select Datenschutz","bootscore"),value:t,options:this.state.datenschutzSelects,__nextHasNoMarginBottom:!0,onChange:this.onChangeDatenschutz}),(0,e.createElement)(o,{label:"Iframe URL",value:l,rows:8,__nextHasNoMarginBottom:!0,onChange:this.onUrlChange}),(0,e.createElement)(o,{label:"Link große Karte",value:p,rows:3,type:"text",__nextHasNoMarginBottom:!0,onChange:this.onLargeUrlChange}),(0,e.createElement)(s,{label:"Breite (px)",value:m,type:"number",__nextHasNoMarginBottom:!0,onChange:this.onWidthChange}),(0,e.createElement)(s,{label:"Höhe (px)",value:h,type:"number",__nextHasNoMarginBottom:!0,onChange:this.onHeightChange}))),(0,e.createElement)("div",{className:"openstreetmap-iframe-wrapper"},(0,e.createElement)("div",{className:"osm-iframe"},(0,e.createElement)("div",{ref:this.osmIframe,className:"iframe-osm-overlay"}),(0,e.createElement)("iframe",{src:l,width:m,height:h,className:"openstreetmap-iframe",allowFullScreen:!0}))))}},save:()=>null})})();