(()=>{"use strict";const e=window.React,{registerBlockType:t}=wp.blocks,{InspectorControls:l,MediaPlaceholder:a,MediaUpload:i}=wp.blockEditor,{PanelBody:n,ToggleControl:o,SelectControl:s,RadioControl:m,RangeControl:r,TextControl:d,Button:c,Modal:u}=wp.components,{__}=wp.i18n,{useEffect:g,useState:b}=wp.element;t("hupa/gallery-slideshow-block",{title:"Galerie Slider",icon:"images-alt2",category:"theme-v3-medien",description:"Slider von splideJs mit vielen Optionen.",attributes:{images:{type:"array",default:[]},mediumImages:{type:"array",default:[]},selectedSlider:{type:"string",default:""},sliderId:{type:"string",default:""},sliderHeight:{type:"number",default:200},thumbHeight:{type:"number",default:150},thumbFocus:{type:"text",default:"center"},objectPosition:{type:"string",default:"center"},objectFit:{type:"string",default:"cover"},imageSize:{type:"string",default:"large"},thumbSize:{type:"string",default:"medium"},showFocus:{type:"boolean",default:!1},enableLightbox:{type:"boolean",default:!1},openNewTab:{type:"boolean",default:!1},clickAction:{type:"string",default:""},imgLink:{type:"string",default:""},lightboxSingle:{type:"boolean",default:!1},layout:{type:"string",default:"slideshow"}},edit({attributes:t,setAttributes:h}){const{images:p,lightboxSingle:x,clickAction:y,mediumImages:v,thumbSize:E,imageSize:_,layout:k,sliderHeight:N,objectPosition:f,objectFit:S,thumbHeight:w,thumbFocus:H,sliderId:F,showFocus:C}=t;if(!F){const e=`${Math.random().toString(36).slice(2,9)}`;h({sliderId:e})}const[j,M]=b([]),[B,z]=b(t.selectedSlider),[T,I]=b(""),[P,L]=b(),[A,O]=b(),[$,R]=b(!1);return g((()=>{if(p.length>0){const e=document.querySelector(".sortable-list");e&&jQuery(e).sortable({update:(t,l)=>{const a=jQuery(e).sortable("toArray",{attribute:"data-id"}).map((e=>parseInt(e,10))).map((e=>p.find((t=>t.id===e))));h({images:a})}})}}),[p]),g((()=>{wp.apiFetch({path:hummeltRestEditorObj.gutenberg_rest_path+"settings",method:"POST",data:{method:"get_theme_slider"}}).then((e=>{e.status&&M(e.slider)})).catch((e=>{console.error("Fehler beim Laden der Optionen:",e)}))}),[]),(0,e.createElement)("div",{className:"slideshow-editor"},(0,e.createElement)(l,null,(0,e.createElement)(n,{title:__("Slider Settings","text-domain")},(0,e.createElement)(s,{label:"Slider auswählen",__nextHasNoMarginBottom:!0,value:B,options:j,onChange:e=>{z(e),h({selectedSlider:e})}}),(0,e.createElement)(s,{label:__("Image Size","text-domain"),__nextHasNoMarginBottom:!0,value:_,options:[{label:__("Thumbnail","text-domain"),value:"thumbnail"},{label:__("Medium","text-domain"),value:"medium"},{label:__("Large","text-domain"),value:"large"},{label:__("Full","text-domain"),value:"full"}],onChange:e=>h({imageSize:e})}),(0,e.createElement)(s,{label:__("Object Fit","text-domain"),__nextHasNoMarginBottom:!0,value:S,options:[{label:__("cover","text-domain"),value:"cover"},{label:__("contain","text-domain"),value:"contain"},{label:__("none","text-domain"),value:"none"},{label:__("inherit","text-domain"),value:"inherit"}],onChange:e=>h({objectFit:e})}),(0,e.createElement)(d,{label:"Object-Position",value:f,__nextHasNoMarginBottom:!0,type:"text",onChange:e=>h({objectPosition:e})}),(0,e.createElement)("hr",null),(0,e.createElement)(o,{label:__("Focus aktiv","text-domain"),__nextHasNoMarginBottom:!0,checked:C,onChange:()=>h({showFocus:!C})}),(0,e.createElement)(d,{label:"Focus",disabled:!C,value:H,__nextHasNoMarginBottom:!0,type:"text",onChange:e=>h({thumbFocus:e}),help:"mögliche Werte: 0-9 | center | false"}),(0,e.createElement)(r,{label:"Feste Höhe (px)",value:N,__nextHasNoMarginBottom:!0,onChange:e=>h({sliderHeight:e}),min:0,max:1e3}),(0,e.createElement)(m,{label:__("Aktion beim klicken","text-domain"),selected:y,__nextHasNoMarginBottom:!0,options:[{label:__("keine Aktion","text-domain"),value:""},{label:__("Lightbox","text-domain"),value:"lightbox"},{label:__("Individuell","text-domain"),value:"individuell"}],onChange:e=>h({clickAction:e})}),(0,e.createElement)("div",{className:"lightbox"===y?"":"d-none"},(0,e.createElement)(o,{label:__("Lightbox single","text-domain"),__nextHasNoMarginBottom:!0,checked:x,onChange:()=>h({lightboxSingle:!x})})),(0,e.createElement)("div",{style:{margin:".5rem 0"}}),(0,e.createElement)(m,{label:__("Layout","text-domain"),selected:k,__nextHasNoMarginBottom:!0,options:[{label:__("Slideshow","text-domain"),value:"slideshow"},{label:__("Gallery with Thumbnails","text-domain"),value:"gallery"}],onChange:e=>h({layout:e})}),(0,e.createElement)("div",{className:"slideshow"===k?"d-none":""},(0,e.createElement)(s,{label:__("Thumbnail Size","text-domain"),__nextHasNoMarginBottom:!0,value:E,options:[{label:__("Thumbnail","text-domain"),value:"thumbnail"},{label:__("Medium","text-domain"),value:"medium"},{label:__("Large","text-domain"),value:"medium_large"},{label:__("Full","text-domain"),value:"full"}],onChange:e=>h({thumbSize:e})}),(0,e.createElement)(r,{label:"Thumbnail Höhe (Px)",value:w,__nextHasNoMarginBottom:!0,onChange:e=>h({thumbHeight:e}),min:0,max:1e3})))),p.length>0?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("ul",{className:"sortable-list list-unstyled row g-3"},p.map(((t,l)=>(0,e.createElement)("li",{key:t.id,className:"sortable-item col-auto","data-id":t.id},(0,e.createElement)("img",{src:t.url,alt:t.alt,className:"img-fluid rounded border",style:{height:"150px",objectFit:"cover"}}),(0,e.createElement)("div",null,(0,e.createElement)("button",{className:"btn btn-link text-decoration-none text-danger btn-sm mt-1",onClick:()=>(e=>{const t=p.filter(((t,l)=>l!==e)),l=v.filter(((t,l)=>l!==e));h({images:t}),h({mediumImages:l})})(l)},"löschen"),"individuell"===y?(0,e.createElement)("button",{className:"btn btn-link text-primary text-decoration-none btn-sm mt-1",onClick:()=>(e=>{const t=p.find((({id:t})=>t===e));I(t.link),L(t.tab),O(t.id),R(!0)})(t.id)},"Optionen"):""))))),(0,e.createElement)("div",{className:"add-images-button"},(0,e.createElement)(i,{onSelect:e=>{const t=[...p,...e.map((e=>({id:e.id,url:e.url,alt:e.alt||""})))];h({images:t})},allowedTypes:["image"],multiple:!0,render:({open:t})=>(0,e.createElement)(c,{onClick:t,variant:"primary",className:"add-images-button"},__("Bild hinzufügen","text-domain"))}))):(0,e.createElement)(a,{onSelect:e=>{h({images:e.map((e=>({id:e.id,link:"",tab:!1,url:e?.sizes?.[_]?.url||e?.url||"",alt:e.alt,title:e.caption||""})))}),h({mediumImages:e.map((e=>({id:e.id,url:e?.sizes?.[E]?.url||e?.url||"",alt:e.alt,title:e.caption||""})))})},allowedTypes:["image"],multiple:!0}),$&&(0,e.createElement)(u,{title:"Bildoptionen",onRequestClose:()=>R(!1)},(0,e.createElement)("div",null,(0,e.createElement)(d,{label:"Link-Url",value:T,__nextHasNoMarginBottom:!0,type:"text",onChange:e=>I(e)}),(0,e.createElement)("div",{style:{margin:".5rem 0"}}),(0,e.createElement)(o,{disabled:!T,label:__("in neuem Tab öffnen","text-domain"),__nextHasNoMarginBottom:!0,checked:P||!1,onChange:e=>L(e)})),(0,e.createElement)(c,{isPrimary:!0,onClick:()=>{const e=p.map((e=>e.id===A?{...e,link:T,tab:P}:e));h({images:e}),R(!1)},style:{marginTop:"18px"}},"Speichern")))},save({attributes:t}){const{images:l,mediumImages:a,clickAction:i,lightboxSingle:n,imageSize:o,layout:s,objectPosition:m,selectedSlider:r,sliderHeight:d,objectFit:c,thumbHeight:u,sliderId:g,thumbFocus:b,showFocus:h}=t;return r&&l.length?"gallery"===s?(0,e.createElement)("div",{"data-focus-active":h,"data-lightbox-single":n,"data-focus":b,"data-slider":r,className:"thumbnail-slider"},(0,e.createElement)("section",{id:`main-carousel-${g}`,className:"splide carousel-splide "+("lightbox"===i?"with-lightbox":""),"aria-label":"Gallery"},(0,e.createElement)("div",{className:"splide__track"},(0,e.createElement)("div",{style:{height:d?d+"px":"100%"},className:"splide__list"},l.map((t=>(0,e.createElement)("a",{target:t.tab?"_blank":"_self",href:"lightbox"===i?t.url:""!==t.link?t.link:"",className:"splide__slide "+("lightbox"===i||"individuell"===i&&""!==t.link?"cursor-pointer":"pe-none"),key:t.id},(0,e.createElement)("img",{style:{objectPosition:m,objectFit:c,height:d?d+"px":"100%"},"data-splide-lazy":t.url,alt:t.alt,className:`size-${o}`}))))))),(0,e.createElement)("section",{id:`main-carousel-thumbnails-${g}`,className:"thumbnails mt-2 splide","aria-label":"Thumbnails"},(0,e.createElement)("div",{className:"splide__track"},(0,e.createElement)("ul",{id:`thumbnails-${g}`,className:"splide__list"},a.map((t=>(0,e.createElement)("li",{style:{height:"100%",maxHeight:u+"px"},className:"thumbnail thumbnail-splide splide__slide",key:t.id},(0,e.createElement)("img",{style:{objectPosition:m,objectFit:c,height:u+"px"},"data-splide-lazy":t.url,alt:t.alt})))))))):(0,e.createElement)("div",{"data-focus-active":h,"data-lightbox-single":n,"data-focus":b,"data-slider":r,className:"theme-slider"},(0,e.createElement)("div",{id:`slider-${g}`,className:"slideshow splide "+("lightbox"===i?"with-lightbox":"")},(0,e.createElement)("div",{className:"splide__track"},(0,e.createElement)("div",{className:"splide__list "+(l.length<3?"justify-content-center":"")},l.map((t=>(0,e.createElement)("a",{target:t.tab?"_blank":"_self",href:"lightbox"===i?t.url:""!==t.link?t.link:"",title:t.title,style:{height:"100%",maxHeight:d?d+"px":"100%"},className:"splide__slide "+("lightbox"===i||"individuell"===i&&""!==t.link?"cursor-pointer":"pe-none"),key:t.id},(0,e.createElement)("div",{className:"slide-wrapper"},(0,e.createElement)("div",{className:"slide-inner"},(0,e.createElement)("img",{style:{height:d?d+"px":"100%",width:"100%",maxHeight:"100%",objectPosition:m,objectFit:c},"data-splide-lazy":t.url,alt:t.alt,className:`size-${o}`})))))))))):(0,e.createElement)(e.Fragment,null)}})})();